# Техническое задание (ТЗ)
## Проект: HR Web System (кадровая система) для локального сервера

---

### 1) Цель проекта

Создать быстрое и безопасное веб-приложение для отдела кадров, работающее в локальной сети компании, с несколькими ролями пользователей и карточкой сотрудника (данные + фото + загрузка сканов документов), развернутое в Docker изолированно от других контейнеров/проектов.

---

### 2) Среда и развертывание

#### 2.1. Размещение
Приложение работает на локальном сервере компании.
**Доступ:** через браузер по локальному адресу (пример: `http://hr.local` или `http://192.168.1.xx`).

#### 2.2. Docker-архитектура (обязательно)
Проект разворачивается в отдельном `docker-compose`, не влияя на существующие контейнеры.
**Требования к изоляции:**
- отдельная сеть (`docker network`) проекта;
- отдельные `volumes` проекта;
- уникальные имена сервисов/контейнеров;
- порты не конфликтуют с другими сервисами.

---

### 3) Роли и доступ (RBAC)
Система поддерживает учетные записи и роли:

- **Кадровик**
  - Полный доступ к сотрудникам: создание/редактирование профиля, загрузка документов, просмотр списка сотрудников.
- **Руководитель**
  - Просмотр сотрудников и их профилей (без редактирования чувствительных данных, если так решим).
- **Бухгалтер**
  - Просмотр данных, связанных с оплатой (зарплата/договор), возможно ограниченный доступ к документам.
- **Сотрудник**
  - Просмотр только своего профиля (и, при необходимости, части данных).

*Права должны быть гибкими: можно будет уточнить, что именно видит бухгалтер/руководитель (зарплата, договор, документы).*

---

### 4) Функциональные требования (MVP)

#### 4.1. Авторизация и учетные записи
- Страница входа (логин/пароль).
- Смена пароля (минимум для админа/кадровика).
- Управление пользователями (создание/назначение роли) — доступно администратору/кадровику.

#### 4.2. Дашборд (главная страница)
После входа пользователь видит Dashboard с карточками и быстрыми действиями.
**Содержимое дашборда (минимум):**
- Кол-во сотрудников всего.
- Новые сотрудники за 30 дней.
- Сотрудники с неполными профилями (например: “незаполнено > 30%”).
- Быстрая кнопка: “Добавить сотрудника” (для кадровика).
- Блок “Последние действия” (кто что изменил) — если включим Audit Log (рекомендовано).

#### 4.3. Список сотрудников
Отдельная страница “Сотрудники”:
- Таблица сотрудников (ФИО, отдел, должность, телефон/почта (если будет), статус).
- Поиск по ФИО.
- Фильтр по отделу/должности.
- Сортировка (ФИО, отдел, дата добавления).
- Клик по строке открывает профиль сотрудника.

#### 4.4. Добавление нового сотрудника
Форма “Добавить сотрудника” (доступ: кадровик):
- После сохранения создается профиль сотрудника и открывается его карточка.

#### 4.5. Профиль сотрудника (карточка)
Страница профиля должна быть визуально “как личное дело”.
**Видимые блоки:**
- **Шапка профиля**
  - Фото сотрудника (аватар).
  - ФИО (крупно), отдел, должность.
  - Статус: “Активен / Уволен / В отпуске” (на старте можно только “Активен/Не активен”, остальное позже).
  - Процент заполненности профиля (progress bar + число %, например 65%).
- **Основные данные**
  - ФИО
  - Дата рождения (рекомендовано)
  - Паспорт (серия/номер, кем и когда выдан)
  - ИНН
  - Адрес
  - Контакты: телефон, email (рекомендовано)
  - Отдел
  - Должность
- **Рабочие данные**
  - Зарплата (доступ ограничить: бухгалтер/кадровик/руководитель по правилам)
  - Договор (номер/дата, тип договора)
  - Дата приема на работу (рекомендовано)
  - Примечание/комментарий (textarea)
- **Документы (сканы) — 9 наименований**
  - В профиле сотрудника должен быть раздел “Документы”, где кадровик может загрузить файлы.
  - Формат: список из 9 фиксированных типов документов (с подписью и кнопкой Upload).
  - **Для каждого документа:**
    - статус: “не загружен / загружен”,
    - дата загрузки,
    - кто загрузил,
    - кнопки: “посмотреть/скачать”, “заменить”, “удалить” (удаление — только кадровик/админ).
  - **9 типов документов (можно менять, но фиксируем по умолчанию):**
    1. Паспорт (скан)
    2. ИНН (скан)
    3. Трудовой договор
    4. Приказ о приёме
    5. Диплом/образование
    6. Фото 3×4 / личное фото (если отдельно)
    7. Мед.справка (если требуется)
    8. СНИЛС/страховой (или местный аналог)
    9. Прочее (универсальный слот)

*Если нужно строго “9 и только 9” — оставляем фиксировано. Если в будущем нужно больше — делаем “динамические”.*

---

### 5) Нефункциональные требования

#### 5.1. Производительность
- Открытие списка сотрудников и профиля — “быстро”, без тяжелых страниц.
- Пагинация списка сотрудников (например по 25/50).

#### 5.2. Безопасность (обязательно)
- Хранение паролей только в хэшированном виде.
- Ролевой доступ (RBAC) — пользователь не может видеть чужие данные без права.
- **Защита загрузки файлов:**
  - ограничение типов: PDF/JPG/PNG (минимум),
  - ограничение размера (например 10–20 МБ на файл),
  - файлы не должны быть доступны по прямой ссылке без авторизации.
- **Журнал действий (Audit log) — рекомендовано:**
  - кто создал/изменил профиль,
  - кто загрузил/удалил документ.

#### 5.3. Резервное копирование
- Бэкап базы данных + файлов документов (через `docker volumes`).
- Регламент: ежедневно/еженедельно (опишем в инструкции).

---

### 6) Страницы “чтобы было ещё что-нибудь” (полезное и реалистичное)
Добавляем 2–3 страницы, которые действительно пригодятся:

#### 6.1. “Отделы и должности” (справочники)
- CRUD отделов
- CRUD должностей
- Используются в карточке сотрудника (выпадающий список)

#### 6.2. “Отчёты” (простые)
- “Список сотрудников по отделам” (фильтр + экспорт)
- “Незаполненные профили” (топ проблемных карточек)
- Экспорт в Excel/PDF (можно как этап 2)

#### 6.3. “Настройки”
- Управление пользователями и ролями
- Политики: максимальный размер файла, разрешенные форматы

---

### 7) Данные (минимальная модель)
**Сущности (объекты системы):**
- `User` (пользователь системы)
- `Role` (роль)
- `Employee` (сотрудник)
- `Department` (отдел)
- `Position` (должность)
- `EmployeeDocument` (документ сотрудника: тип + файл + метаданные)
- `AuditLog` (журнал действий) — рекомендовано

---

### 8) UX/Визуальное представление (чтобы было “в голове видно”)
- **Меню слева:** Dashboard / Сотрудники / Отделы и должности / Отчёты / Настройки
- **Вверху:** профиль пользователя + кнопка “Выйти”
- **Карточка сотрудника:**
  - слева фото + прогресс заполненности,
  - справа вкладки: “Данные”, “Работа”, “Документы”.

---

### 9) Критерии готовности (MVP)
**Считается готовым, если:**
- Есть роли и вход.
- Кадровик может создать сотрудника.
- Есть список сотрудников + поиск.
- Есть профиль сотрудника со всеми полями.
- Есть загрузка 9 типов документов и фото.
- Есть прогресс заполненности.
- Всё разворачивается через Docker отдельно и не ломает другие контейнеры.

---
### Дополнения к ТЗ

#### Структура хранения файлов по папкам сотрудника
**Хранение документов**
- При создании сотрудника система формирует уникальный идентификатор сотрудника (Employee ID / UUID).
- Для каждого сотрудника автоматически создаётся папка хранения файлов в файловом хранилище приложения.
- **Пример структуры:**
  - `/data/media/employees/<employee_uuid>/photo/` — фото сотрудника
  - `/data/media/employees/<employee_uuid>/docs/` — документы сотрудника
- Внутри `docs/` — файлы по типам документов (или с понятными именами/префиксами)
- **Пример именования:**
  - `passport_2026-01-27.pdf`
  - `inn_2026-01-27.jpg`
  - `contract_2026-01-27.pdf`
- **Требование безопасности:** доступ к файлам только через приложение (по правам), без “прямых” открытых ссылок.

#### Обновление ТЗ: папка сотрудника `Name_Surname_ID`
**Правило именования папки**
- Для каждого сотрудника создаётся папка: `employees/<Name>_<Surname>_<ID>/`
- `Name` и `Surname` берутся из полей ФИО на латинском (отдельные поля в профиле).
- `ID` — системный уникальный идентификатор (например авто-ID из БД или UUID-короткий).
- **Важно (безопасность и стабильность):**
  - Имя папки санитизируется: только `[A-Za-z0-9_-]`, пробелы → `_`, всё лишнее удаляется.
  - Если латинские поля пустые — система не даёт сохранить сотрудника (или подставляет `Unknown`, но лучше запретить).
- **Пример:** `employees/Komil_Rahmonov_1024/docs/passport_2026-01-27.pdf`

---

### Современный стек (без Python) — рекомендую этот

- **Backend (современный и строгий)**
  - **NestJS** (Node.js + TypeScript)
    - *Очень “enterprise”: модули, DI, guards, decorators, удобно для RBAC*
  - **API:** REST (быстро) + можно позже добавить Swagger
  - **ORM:** **Prisma**
    - *Очень удобные миграции и типобезопасность*
  - **Auth:**
    - JWT + Refresh tokens (опционально)
    - RBAC (roles: кадровик/руководитель/бухгалтер/сотрудник)
- **Database**
  - **MySQL 8**
- **Frontend (современный UI)**
  - **Next.js** (React + TypeScript)
    - *Быстро, современно, удобно делать панели/таблицы/формы*
- **UI/стиль:**
  - **Tailwind CSS**
  - **shadcn/ui** (готовые строгие компоненты)
  - **Тема:** dark green (зададим через CSS variables / Tailwind config)
- **Reverse proxy / статика**
  - **Nginx** (единая точка входа)
- **Файлы (документы/фото)**
  - Хранение на диске в Docker volume
  - Папки по правилу `Name_Surname_ID`
  - Доступ к файлам только через авторизованный endpoint (не прямой URL)

---

### Скелет проекта (структура репо)
```
hrms/
  docker/
    nginx/
      default.conf
  backend/
    src/
      modules/
        auth/
        users/
        employees/
        departments/
        positions/
        documents/
        dashboard/
      common/
        guards/
        decorators/
        pipes/
        utils/
    prisma/
      schema.prisma
      migrations/
    Dockerfile
    package.json
    .env.example
  frontend/
    app/
      (auth)/
      dashboard/
      employees/
      departments/
      reports/
      settings/
    components/
    lib/
    styles/
    Dockerfile
    package.json
    tailwind.config.ts
    .env.example
  docker-compose.yml
  .env
  README.md
```

---

### `docker-compose.yml` (изолированно, ничего не ломаем)
```yaml
services:
  db:
    image: mysql:8.0
    container_name: hrms_db
    environment:
      MYSQL_DATABASE: hrms
      MYSQL_USER: hrms
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
    volumes:
      - hrms_mysql:/var/lib/mysql
    networks:
      - hrms_net
    restart: unless-stopped

  backend:
    build: ./backend
    container_name: hrms_backend
    env_file: .env
    depends_on:
      - db
    volumes:
      - hrms_storage:/app/storage
    networks:
      - hrms_net
    restart: unless-stopped

  frontend:
    build: ./frontend
    container_name: hrms_frontend
    env_file: .env
    depends_on:
      - backend
    networks:
      - hrms_net
    restart: unless-stopped

  nginx:
    image: nginx:1.27
    container_name: hrms_nginx
    depends_on:
      - frontend
      - backend
    ports:
      - "8088:80"
    volumes:
      - ./docker/nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
      - hrms_storage:/var/www/storage:ro
    networks:
      - hrms_net
    restart: unless-stopped

volumes:
  hrms_mysql:
  hrms_storage:

networks:
  hrms_net:
    name: hrms_net
    driver: bridge
```

---

### Nginx (роутинг фронта и API)
```nginx
server {
  listen 80;
  client_max_body_size 20M;

  location /api/ {
    proxy_pass http://backend:7070/;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }

  location / {
    proxy_pass http://frontend:7070/;
    proxy_set_header Host $host;
  }
}
```

---

### Реализация папки `Name_Surname_ID` (как будет работать)
- **В `employees` таблице будут поля:**
  - `latinFirstName`
  - `latinLastName`
  - `id` (автоинкремент)
- **При загрузке документа backend формирует путь:**
  - `employees/${sanitize(latinFirstName)}_${sanitize(latinLastName)}_${id}/docs/<docType>_<date>.<ext>`
- **Аналогично для фото:**
  - `.../photo/avatar.<ext>`

---

### Тёмно-зелёная строгая тема (frontend)
Сделаем “корпоративный” стиль:
- **фон:** почти чёрный/графит
- **акцент:** тёмно-зелёный (кнопки, активные пункты меню, прогрессбар)
- **таблицы:** строгие, тонкие разделители, без кислотных цветов

*(Это делается 10–15 строками в `globals.css` + Tailwind variables.)*
